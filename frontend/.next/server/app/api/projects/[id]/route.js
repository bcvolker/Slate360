"use strict";(()=>{var e={};e.id=361,e.ids=[361,494],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},51652:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>Z,originalPathname:()=>D,patchFetch:()=>P,requestAsyncStorage:()=>x,routeModule:()=>q,serverHooks:()=>I,staticGenerationAsyncStorage:()=>w,staticGenerationBailout:()=>S});var i={};r.r(i),r.d(i,{DELETE:()=>f,GET:()=>y,PUT:()=>h});var n=r(95419),a=r(69108),s=r(99678),o=r(78070),d=r(81355),u=r(82002),l=r(65256),m=r(81494),c=r(42192);let p=require("mongodb"),g=l.Ry({name:l.Z_().min(1,"Project name is required").max(100,"Project name must be less than 100 characters").optional(),description:l.Z_().min(1,"Description is required").max(500,"Description must be less than 500 characters").optional(),type:l.Km(["residential","commercial","industrial","infrastructure","renovation","other"]).optional(),status:l.Km(["planning","active","on-hold","completed","cancelled"]).optional(),location:l.Ry({address:l.Z_().min(1,"Address is required").optional(),city:l.Z_().min(1,"City is required").optional(),state:l.Z_().min(1,"State is required").optional(),zipCode:l.Z_().min(1,"ZIP code is required").optional(),country:l.Z_().min(1,"Country is required").optional(),coordinates:l.Ry({lat:l.Rx().min(-90).max(90).optional(),lng:l.Rx().min(-180).max(180).optional()}).optional()}).optional(),client:l.Ry({name:l.Z_().min(1,"Client name is required").optional(),email:l.Z_().email("Invalid client email").optional(),phone:l.Z_().optional(),company:l.Z_().optional()}).optional(),timeline:l.Ry({startDate:l.Z_().datetime("Invalid start date").optional(),endDate:l.Z_().datetime("Invalid end date").optional(),estimatedDuration:l.Rx().min(1,"Estimated duration must be at least 1 day").optional()}).optional(),budget:l.Ry({estimated:l.Rx().min(0,"Estimated budget cannot be negative").optional(),actual:l.Rx().min(0,"Actual budget cannot be negative").optional(),currency:l.Z_().optional()}).optional(),team:l.IX(l.Ry({userId:l.Z_().min(1,"User ID is required"),role:l.Km(["project_manager","architect","engineer","designer","contractor","consultant"]),permissions:l.IX(l.Km(["read","write","admin"])).default(["read"])})).optional(),tags:l.IX(l.Z_().max(50)).max(20,"Maximum 20 tags allowed").optional(),metadata:l.IM(l.Yj()).optional()});async function y(e,{params:t}){try{let e=await (0,d.getServerSession)(u.L);if(!e)return o.Z.json({error:"Unauthorized"},{status:401});let{id:r}=t;if(!p.ObjectId.isValid(r))return o.Z.json({error:"Invalid project ID"},{status:400});await (0,m.default)();let i=await c.Z.findById(r).populate("team.userId","name email avatar role").populate("createdBy","name email").lean();if(!i)return o.Z.json({error:"Project not found"},{status:404});if(!e.user.id||!e.user.role)return o.Z.json({error:"User information incomplete"},{status:400});if(!await b(e.user.id,e.user.role,i))return o.Z.json({error:"Access denied"},{status:403});return o.Z.json({project:i})}catch(e){return console.error("GET /api/projects/[id] error:",e),o.Z.json({error:"Internal server error"},{status:500})}}async function h(e,{params:t}){try{let r=await (0,d.getServerSession)(u.L);if(!r)return o.Z.json({error:"Unauthorized"},{status:401});let{id:i}=t;if(!p.ObjectId.isValid(i))return o.Z.json({error:"Invalid project ID"},{status:400});let n=await e.json(),a=g.safeParse(n);if(!a.success)return o.Z.json({error:"Validation failed",details:a.error.errors},{status:400});let s=a.data;await (0,m.default)();let l=await c.Z.findById(i);if(!l)return o.Z.json({error:"Project not found"},{status:404});if(!await v(r.user.id,r.user.role,l))return o.Z.json({error:"Write access denied"},{status:403});let y=await c.Z.findByIdAndUpdate(i,{...s,updatedAt:new Date},{new:!0,runValidators:!0}).populate("team.userId","name email avatar role").populate("createdBy","name email");return o.Z.json({message:"Project updated successfully",project:y})}catch(e){if(console.error("PUT /api/projects/[id] error:",e),11e3===e.code)return o.Z.json({error:"Project with this name already exists"},{status:409});return o.Z.json({error:"Internal server error"},{status:500})}}async function f(e,{params:t}){try{let e=await (0,d.getServerSession)(u.L);if(!e)return o.Z.json({error:"Unauthorized"},{status:401});let{id:r}=t;if(!p.ObjectId.isValid(r))return o.Z.json({error:"Invalid project ID"},{status:400});await (0,m.default)();let i=await c.Z.findById(r);if(!i)return o.Z.json({error:"Project not found"},{status:404});if(!await j(e.user.id,e.user.role,i))return o.Z.json({error:"Admin access required to delete project"},{status:403});if("active"===i.status||"completed"===i.status)return o.Z.json({error:"Cannot delete active or completed projects"},{status:400});return await c.Z.findByIdAndDelete(r),o.Z.json({message:"Project deleted successfully"})}catch(e){return console.error("DELETE /api/projects/[id] error:",e),o.Z.json({error:"Internal server error"},{status:500})}}async function b(e,t,r){return!!("ceo"===t||"admin"===t||r.team.some(t=>t.userId===e))||r.createdBy===e}async function v(e,t,r){if("ceo"===t||"admin"===t)return!0;let i=r.team.find(t=>t.userId===e);return!!(i&&i.permissions.includes("write"))||r.createdBy===e}async function j(e,t,r){if("ceo"===t||"admin"===t)return!0;let i=r.team.find(t=>t.userId===e);return!!(i&&i.permissions.includes("admin"))||r.createdBy===e}let q=new n.AppRouteRouteModule({definition:{kind:a.x.APP_ROUTE,page:"/api/projects/[id]/route",pathname:"/api/projects/[id]",filename:"route",bundlePath:"app/api/projects/[id]/route"},resolvedPagePath:"C:\\Slate360\\frontend\\src\\app\\api\\projects\\[id]\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:x,staticGenerationAsyncStorage:w,serverHooks:I,headerHooks:Z,staticGenerationBailout:S}=q,D="/api/projects/[id]/route";function P(){return(0,s.patchFetch)({serverHooks:I,staticGenerationAsyncStorage:w})}},82002:(e,t,r)=>{r.d(t,{L:()=>i});let i={providers:[(0,r(86485).Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},authorize:async e=>e?.email&&e?.password?{id:"1",email:e.email,name:"Demo User",role:"user",tier:"free"}:null})],session:{strategy:"jwt",maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.tier=t.tier),e),session:async({session:e,token:t})=>(t&&(e.user.role=t.role,e.user.tier=t.tier),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},secret:process.env.NEXTAUTH_SECRET}},81494:(e,t,r)=>{r.r(t),r.d(t,{connectToDatabase:()=>s,default:()=>o});var i=r(11185),n=r.n(i);let a=global.mongoose;if(a||(a=global.mongoose={conn:null,promise:null}),!a)throw Error("Failed to initialize mongoose cache");async function s(){let e=process.env.MONGODB_URI;if(!e)throw Error("Please define the MONGODB_URI environment variable inside .env.local");if(a.conn)return a.conn;a.promise||(a.promise=n().connect(e,{bufferCommands:!1}).then(e=>e));try{a.conn=await a.promise}catch(e){throw a.promise=null,e}return a.conn}let o=s},42192:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),n=r.n(i);let a=new i.Schema({name:{type:String,required:[!0,"Project name is required"],trim:!0,maxlength:[100,"Project name cannot exceed 100 characters"],unique:!0,index:!0},description:{type:String,required:[!0,"Project description is required"],trim:!0,maxlength:[500,"Project description cannot exceed 500 characters"]},type:{type:String,required:[!0,"Project type is required"],enum:{values:["residential","commercial","industrial","infrastructure","renovation","other"],message:"Invalid project type"},index:!0},status:{type:String,required:[!0,"Project status is required"],enum:{values:["planning","active","on-hold","completed","cancelled"],message:"Invalid project status"},default:"planning",index:!0},location:{address:{type:String,required:[!0,"Address is required"],trim:!0},city:{type:String,required:[!0,"City is required"],trim:!0},state:{type:String,required:[!0,"State is required"],trim:!0},zipCode:{type:String,required:[!0,"ZIP code is required"],trim:!0},country:{type:String,required:[!0,"Country is required"],default:"USA",trim:!0},coordinates:{lat:{type:Number,min:[-90,"Latitude must be between -90 and 90"],max:[90,"Latitude must be between -90 and 90"]},lng:{type:Number,min:[-180,"Longitude must be between -180 and 180"],max:[180,"Longitude must be between -180 and 180"]}}},client:{name:{type:String,required:[!0,"Client name is required"],trim:!0},email:{type:String,required:[!0,"Client email is required"],lowercase:!0,trim:!0},phone:{type:String,trim:!0},company:{type:String,trim:!0},contactPerson:{type:String,trim:!0},billingAddress:{type:String,trim:!0}},timeline:{startDate:{type:Date},endDate:{type:Date},estimatedDuration:{type:Number,min:[1,"Estimated duration must be at least 1 day"]},milestones:[{name:{type:String,required:!0,trim:!0},date:{type:Date,required:!0},description:{type:String,trim:!0},completed:{type:Boolean,default:!1}}]},budget:{estimated:{type:Number,min:[0,"Estimated budget cannot be negative"]},actual:{type:Number,min:[0,"Actual budget cannot be negative"]},currency:{type:String,default:"USD",uppercase:!0},breakdown:{materials:{type:Number,min:[0,"Materials cost cannot be negative"]},labor:{type:Number,min:[0,"Labor cost cannot be negative"]},equipment:{type:Number,min:[0,"Equipment cost cannot be negative"]},permits:{type:Number,min:[0,"Permits cost cannot be negative"]},contingency:{type:Number,min:[0,"Contingency cost cannot be negative"]}},invoices:[{number:{type:String,required:!0,trim:!0},amount:{type:Number,required:!0,min:[0,"Invoice amount cannot be negative"]},date:{type:Date,required:!0},status:{type:String,enum:["pending","paid","overdue"],default:"pending"}}]},team:[{userId:{type:i.Schema.Types.ObjectId,ref:"User",required:[!0,"Team member user ID is required"]},role:{type:String,required:[!0,"Team member role is required"],enum:{values:["project_manager","architect","engineer","designer","contractor","consultant"],message:"Invalid team member role"}},permissions:[{type:String,enum:{values:["read","write","admin"],message:"Invalid permission level"},default:["read"]}],joinedAt:{type:Date,default:Date.now},isActive:{type:Boolean,default:!0}}],tags:[{type:String,trim:!0,maxlength:[50,"Tag cannot exceed 50 characters"],validate:{validator:function(e){return e.length<=20},message:"Maximum 20 tags allowed"}}],metadata:{type:i.Schema.Types.Mixed,default:{}},createdBy:{type:i.Schema.Types.ObjectId,ref:"User",required:[!0,"Project creator is required"],index:!0}},{timestamps:!0,toJSON:{virtuals:!0},toObject:{virtuals:!0}});a.virtual("progress").get(function(){return this.calculateProgress()}),a.virtual("daysRemaining").get(function(){if(!this.timeline.endDate)return 0;let e=new Date;return Math.max(0,Math.ceil((new Date(this.timeline.endDate).getTime()-e.getTime())/864e5))}),a.virtual("budgetUtilization").get(function(){return this.calculateBudgetUtilization()}),a.virtual("teamSize").get(function(){return this.team.filter(e=>e.isActive).length}),a.index({name:"text",description:"text"}),a.index({"client.name":1}),a.index({"team.userId":1}),a.index({status:1,type:1}),a.index({createdAt:-1}),a.index({"timeline.startDate":1,"timeline.endDate":1}),a.index({tags:1}),a.methods.addTeamMember=async function(e,t,r=["read"]){if(this.team.find(t=>t.userId.equals(e)))throw Error("User is already a team member");this.team.push({userId:e,role:t,permissions:r,joinedAt:new Date,isActive:!0}),await this.save()},a.methods.removeTeamMember=async function(e){let t=this.team.findIndex(t=>t.userId.equals(e));if(-1===t)throw Error("User is not a team member");this.team[t].isActive=!1,await this.save()},a.methods.updateTeamMemberPermissions=async function(e,t){let r=this.team.find(t=>t.userId.equals(e));if(!r)throw Error("User is not a team member");r.permissions=t,await this.save()},a.methods.calculateProgress=function(){return"completed"===this.status?100:"cancelled"===this.status||"planning"===this.status?0:this.timeline.milestones&&this.timeline.milestones.length>0?Math.round(this.timeline.milestones.filter(e=>e.completed).length/this.timeline.milestones.length*100):({planning:0,active:50,"on-hold":50,completed:100,cancelled:0})[this.status]||0},a.methods.calculateBudgetUtilization=function(){return this.budget.estimated&&this.budget.actual?Math.round(this.budget.actual/this.budget.estimated*100):0},a.methods.addMilestone=async function(e,t,r){this.timeline.milestones||(this.timeline.milestones=[]),this.timeline.milestones.push({name:e,date:t,description:r,completed:!1}),await this.save()},a.methods.completeMilestone=async function(e){if(!this.timeline.milestones)throw Error("No milestones found");let t=this.timeline.milestones.find(t=>t.name===e);if(!t)throw Error("Milestone not found");t.completed=!0,await this.save()},a.statics.findByStatus=function(e){return this.find({status:e})},a.statics.findByType=function(e){return this.find({type:e})},a.statics.findByClient=function(e){return this.find({"client.name":{$regex:e,$options:"i"}})},a.statics.findByTeamMember=function(e){return this.find({"team.userId":e,"team.isActive":!0})},a.pre("save",function(e){if(0===this.team.length&&this.team.push({userId:this.createdBy,role:"project_manager",permissions:["read","write","admin"],joinedAt:new Date,isActive:!0}),this.timeline.startDate&&this.timeline.endDate&&this.timeline.startDate>=this.timeline.endDate){e(Error("Start date must be before end date"));return}if(this.budget.actual&&this.budget.estimated&&(this.budget.actual<0||this.budget.estimated<0)){e(Error("Budget values cannot be negative"));return}e()}),a.pre("remove",function(e){e()});let s=n().models.Project||n().model("Project",a)}};var t=require("../../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[638,457,70,256],()=>r(51652));module.exports=i})();