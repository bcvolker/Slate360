"use strict";(()=>{var e={};e.id=871,e.ids=[871,494],e.modules={11185:e=>{e.exports=require("mongoose")},30517:e=>{e.exports=require("next/dist/compiled/next-server/app-route.runtime.prod.js")},25528:e=>{e.exports=require("next/dist\\client\\components\\action-async-storage.external.js")},91877:e=>{e.exports=require("next/dist\\client\\components\\request-async-storage.external.js")},25319:e=>{e.exports=require("next/dist\\client\\components\\static-generation-async-storage.external.js")},39491:e=>{e.exports=require("assert")},14300:e=>{e.exports=require("buffer")},6113:e=>{e.exports=require("crypto")},82361:e=>{e.exports=require("events")},13685:e=>{e.exports=require("http")},95687:e=>{e.exports=require("https")},63477:e=>{e.exports=require("querystring")},57310:e=>{e.exports=require("url")},73837:e=>{e.exports=require("util")},59796:e=>{e.exports=require("zlib")},33381:(e,t,r)=>{r.r(t),r.d(t,{headerHooks:()=>j,originalPathname:()=>S,patchFetch:()=>D,requestAsyncStorage:()=>v,routeModule:()=>b,serverHooks:()=>q,staticGenerationAsyncStorage:()=>x,staticGenerationBailout:()=>w});var i={};r.r(i),r.d(i,{GET:()=>h,POST:()=>y});var a=r(95419),n=r(69108),s=r(99678),o=r(78070),u=r(81355),d=r(82002),m=r(65256),l=r(81494),c=r(42192);let p=m.Ry({name:m.Z_().min(1,"Project name is required").max(100,"Project name must be less than 100 characters"),description:m.Z_().min(1,"Description is required").max(500,"Description must be less than 500 characters"),type:m.Km(["residential","commercial","industrial","infrastructure","renovation","other"]),status:m.Km(["planning","active","on-hold","completed","cancelled"]).default("planning"),location:m.Ry({address:m.Z_().min(1,"Address is required"),city:m.Z_().min(1,"City is required"),state:m.Z_().min(1,"State is required"),zipCode:m.Z_().min(1,"ZIP code is required"),country:m.Z_().min(1,"Country is required").default("USA"),coordinates:m.Ry({lat:m.Rx().min(-90).max(90).optional(),lng:m.Rx().min(-180).max(180).optional()}).optional()}),client:m.Ry({name:m.Z_().min(1,"Client name is required"),email:m.Z_().email("Invalid client email"),phone:m.Z_().optional(),company:m.Z_().optional()}),timeline:m.Ry({startDate:m.Z_().datetime("Invalid start date").optional(),endDate:m.Z_().datetime("Invalid end date").optional(),estimatedDuration:m.Rx().min(1,"Estimated duration must be at least 1 day").optional()}),budget:m.Ry({estimated:m.Rx().min(0,"Estimated budget cannot be negative").optional(),actual:m.Rx().min(0,"Actual budget cannot be negative").optional(),currency:m.Z_().default("USD")}),team:m.IX(m.Ry({userId:m.Z_().min(1,"User ID is required"),role:m.Km(["project_manager","architect","engineer","designer","contractor","consultant"]),permissions:m.IX(m.Km(["read","write","admin"])).default(["read"])})).optional(),tags:m.IX(m.Z_().max(50)).max(20,"Maximum 20 tags allowed").optional(),metadata:m.IM(m.Yj()).optional()});p.partial().extend({id:m.Z_().min(1,"Project ID is required")});let g=m.Ry({page:m.Z_().transform(Number).pipe(m.Rx().min(1)).default("1"),limit:m.Z_().transform(Number).pipe(m.Rx().min(1).max(100)).default("20"),status:m.Km(["planning","active","on-hold","completed","cancelled"]).optional(),type:m.Km(["residential","commercial","industrial","infrastructure","renovation","other"]).optional(),client:m.Z_().optional(),search:m.Z_().optional(),sortBy:m.Km(["name","createdAt","updatedAt","startDate","endDate","budget"]).default("createdAt"),sortOrder:m.Km(["asc","desc"]).default("desc")});async function h(e){try{let t=await (0,u.getServerSession)(d.L);if(!t)return o.Z.json({error:"Unauthorized"},{status:401});let{searchParams:r}=new URL(e.url),i=g.safeParse(Object.fromEntries(r));if(!i.success)return o.Z.json({error:"Invalid query parameters",details:i.error.errors},{status:400});let{page:a,limit:n,status:s,type:m,client:p,search:h,sortBy:y,sortOrder:f}=i.data;await (0,l.default)();let b={};"ceo"===t.user.role||"admin"===t.user.role||("manager"===t.user.role?b.$or=[{"team.userId":t.user.id},{createdBy:t.user.id}]:b["team.userId"]=t.user.id),s&&(b.status=s),m&&(b.type=m),p&&(b["client.name"]={$regex:p,$options:"i"}),h&&(b.$or=[{name:{$regex:h,$options:"i"}},{description:{$regex:h,$options:"i"}},{"client.name":{$regex:h,$options:"i"}},{"client.company":{$regex:h,$options:"i"}}]);let v={};v[y]="asc"===f?1:-1;let x=(a-1)*n,[q,j]=await Promise.all([c.Z.find(b).sort(v).skip(x).limit(n).populate("team.userId","name email avatar").populate("createdBy","name email").lean(),c.Z.countDocuments(b)]),w=Math.ceil(j/n);return o.Z.json({projects:q,pagination:{page:a,limit:n,total:j,totalPages:w,hasNextPage:a<w,hasPrevPage:a>1},filters:{status:s,type:m,client:p,search:h,sortBy:y,sortOrder:f}})}catch(e){return console.error("GET /api/projects error:",e),o.Z.json({error:"Internal server error"},{status:500})}}async function y(e){try{let t=await (0,u.getServerSession)(d.L);if(!t)return o.Z.json({error:"Unauthorized"},{status:401});let r=await e.json(),i=p.safeParse(r);if(!i.success)return o.Z.json({error:"Validation failed",details:i.error.errors},{status:400});let a=i.data;if(await (0,l.default)(),!t.user.id||!t.user.tier)return o.Z.json({error:"User information incomplete"},{status:400});if(!await f(t.user.id,t.user.tier))return o.Z.json({error:"Project creation limit reached for your tier"},{status:403});let n=new c.Z({...a,createdBy:t.user.id,team:a.team||[{userId:t.user.id,role:"project_manager",permissions:["read","write","admin"]}],createdAt:new Date,updatedAt:new Date});return await n.save(),await n.populate("team.userId","name email avatar"),await n.populate("createdBy","name email"),o.Z.json({message:"Project created successfully",project:n},{status:201})}catch(e){if(console.error("POST /api/projects error:",e),11e3===e.code)return o.Z.json({error:"Project with this name already exists"},{status:409});return o.Z.json({error:"Internal server error"},{status:500})}}async function f(e,t){try{let r=await c.Z.countDocuments({createdBy:e}),i={free:3,premium:25,enterprise:-1}[t]||3;if(-1===i)return!0;return r<i}catch(e){return console.error("Error checking project creation permission:",e),!1}}let b=new a.AppRouteRouteModule({definition:{kind:n.x.APP_ROUTE,page:"/api/projects/route",pathname:"/api/projects",filename:"route",bundlePath:"app/api/projects/route"},resolvedPagePath:"C:\\Slate360\\frontend\\src\\app\\api\\projects\\route.ts",nextConfigOutput:"",userland:i}),{requestAsyncStorage:v,staticGenerationAsyncStorage:x,serverHooks:q,headerHooks:j,staticGenerationBailout:w}=b,S="/api/projects/route";function D(){return(0,s.patchFetch)({serverHooks:q,staticGenerationAsyncStorage:x})}},82002:(e,t,r)=>{r.d(t,{L:()=>i});let i={providers:[(0,r(86485).Z)({name:"credentials",credentials:{email:{label:"Email",type:"email"},password:{label:"Password",type:"password"}},authorize:async e=>e?.email&&e?.password?{id:"1",email:e.email,name:"Demo User",role:"user",tier:"free"}:null})],session:{strategy:"jwt",maxAge:86400},callbacks:{jwt:async({token:e,user:t})=>(t&&(e.role=t.role,e.tier=t.tier),e),session:async({session:e,token:t})=>(t&&(e.user.role=t.role,e.user.tier=t.tier),e)},pages:{signIn:"/auth/signin",error:"/auth/error"},secret:process.env.NEXTAUTH_SECRET}},81494:(e,t,r)=>{r.r(t),r.d(t,{connectToDatabase:()=>s,default:()=>o});var i=r(11185),a=r.n(i);let n=global.mongoose;if(n||(n=global.mongoose={conn:null,promise:null}),!n)throw Error("Failed to initialize mongoose cache");async function s(){let e=process.env.MONGODB_URI;if(!e)throw Error("Please define the MONGODB_URI environment variable inside .env.local");if(n.conn)return n.conn;n.promise||(n.promise=a().connect(e,{bufferCommands:!1}).then(e=>e));try{n.conn=await n.promise}catch(e){throw n.promise=null,e}return n.conn}let o=s},42192:(e,t,r)=>{r.d(t,{Z:()=>s});var i=r(11185),a=r.n(i);let n=new i.Schema({name:{type:String,required:[!0,"Project name is required"],trim:!0,maxlength:[100,"Project name cannot exceed 100 characters"],unique:!0,index:!0},description:{type:String,required:[!0,"Project description is required"],trim:!0,maxlength:[500,"Project description cannot exceed 500 characters"]},type:{type:String,required:[!0,"Project type is required"],enum:{values:["residential","commercial","industrial","infrastructure","renovation","other"],message:"Invalid project type"},index:!0},status:{type:String,required:[!0,"Project status is required"],enum:{values:["planning","active","on-hold","completed","cancelled"],message:"Invalid project status"},default:"planning",index:!0},location:{address:{type:String,required:[!0,"Address is required"],trim:!0},city:{type:String,required:[!0,"City is required"],trim:!0},state:{type:String,required:[!0,"State is required"],trim:!0},zipCode:{type:String,required:[!0,"ZIP code is required"],trim:!0},country:{type:String,required:[!0,"Country is required"],default:"USA",trim:!0},coordinates:{lat:{type:Number,min:[-90,"Latitude must be between -90 and 90"],max:[90,"Latitude must be between -90 and 90"]},lng:{type:Number,min:[-180,"Longitude must be between -180 and 180"],max:[180,"Longitude must be between -180 and 180"]}}},client:{name:{type:String,required:[!0,"Client name is required"],trim:!0},email:{type:String,required:[!0,"Client email is required"],lowercase:!0,trim:!0},phone:{type:String,trim:!0},company:{type:String,trim:!0},contactPerson:{type:String,trim:!0},billingAddress:{type:String,trim:!0}},timeline:{startDate:{type:Date},endDate:{type:Date},estimatedDuration:{type:Number,min:[1,"Estimated duration must be at least 1 day"]},milestones:[{name:{type:String,required:!0,trim:!0},date:{type:Date,required:!0},description:{type:String,trim:!0},completed:{type:Boolean,default:!1}}]},budget:{estimated:{type:Number,min:[0,"Estimated budget cannot be negative"]},actual:{type:Number,min:[0,"Actual budget cannot be negative"]},currency:{type:String,default:"USD",uppercase:!0},breakdown:{materials:{type:Number,min:[0,"Materials cost cannot be negative"]},labor:{type:Number,min:[0,"Labor cost cannot be negative"]},equipment:{type:Number,min:[0,"Equipment cost cannot be negative"]},permits:{type:Number,min:[0,"Permits cost cannot be negative"]},contingency:{type:Number,min:[0,"Contingency cost cannot be negative"]}},invoices:[{number:{type:String,required:!0,trim:!0},amount:{type:Number,required:!0,min:[0,"Invoice amount cannot be negative"]},date:{type:Date,required:!0},status:{type:String,enum:["pending","paid","overdue"],default:"pending"}}]},team:[{userId:{type:i.Schema.Types.ObjectId,ref:"User",required:[!0,"Team member user ID is required"]},role:{type:String,required:[!0,"Team member role is required"],enum:{values:["project_manager","architect","engineer","designer","contractor","consultant"],message:"Invalid team member role"}},permissions:[{type:String,enum:{values:["read","write","admin"],message:"Invalid permission level"},default:["read"]}],joinedAt:{type:Date,default:Date.now},isActive:{type:Boolean,default:!0}}],tags:[{type:String,trim:!0,maxlength:[50,"Tag cannot exceed 50 characters"],validate:{validator:function(e){return e.length<=20},message:"Maximum 20 tags allowed"}}],metadata:{type:i.Schema.Types.Mixed,default:{}},createdBy:{type:i.Schema.Types.ObjectId,ref:"User",required:[!0,"Project creator is required"],index:!0}},{timestamps:!0,toJSON:{virtuals:!0},toObject:{virtuals:!0}});n.virtual("progress").get(function(){return this.calculateProgress()}),n.virtual("daysRemaining").get(function(){if(!this.timeline.endDate)return 0;let e=new Date;return Math.max(0,Math.ceil((new Date(this.timeline.endDate).getTime()-e.getTime())/864e5))}),n.virtual("budgetUtilization").get(function(){return this.calculateBudgetUtilization()}),n.virtual("teamSize").get(function(){return this.team.filter(e=>e.isActive).length}),n.index({name:"text",description:"text"}),n.index({"client.name":1}),n.index({"team.userId":1}),n.index({status:1,type:1}),n.index({createdAt:-1}),n.index({"timeline.startDate":1,"timeline.endDate":1}),n.index({tags:1}),n.methods.addTeamMember=async function(e,t,r=["read"]){if(this.team.find(t=>t.userId.equals(e)))throw Error("User is already a team member");this.team.push({userId:e,role:t,permissions:r,joinedAt:new Date,isActive:!0}),await this.save()},n.methods.removeTeamMember=async function(e){let t=this.team.findIndex(t=>t.userId.equals(e));if(-1===t)throw Error("User is not a team member");this.team[t].isActive=!1,await this.save()},n.methods.updateTeamMemberPermissions=async function(e,t){let r=this.team.find(t=>t.userId.equals(e));if(!r)throw Error("User is not a team member");r.permissions=t,await this.save()},n.methods.calculateProgress=function(){return"completed"===this.status?100:"cancelled"===this.status||"planning"===this.status?0:this.timeline.milestones&&this.timeline.milestones.length>0?Math.round(this.timeline.milestones.filter(e=>e.completed).length/this.timeline.milestones.length*100):({planning:0,active:50,"on-hold":50,completed:100,cancelled:0})[this.status]||0},n.methods.calculateBudgetUtilization=function(){return this.budget.estimated&&this.budget.actual?Math.round(this.budget.actual/this.budget.estimated*100):0},n.methods.addMilestone=async function(e,t,r){this.timeline.milestones||(this.timeline.milestones=[]),this.timeline.milestones.push({name:e,date:t,description:r,completed:!1}),await this.save()},n.methods.completeMilestone=async function(e){if(!this.timeline.milestones)throw Error("No milestones found");let t=this.timeline.milestones.find(t=>t.name===e);if(!t)throw Error("Milestone not found");t.completed=!0,await this.save()},n.statics.findByStatus=function(e){return this.find({status:e})},n.statics.findByType=function(e){return this.find({type:e})},n.statics.findByClient=function(e){return this.find({"client.name":{$regex:e,$options:"i"}})},n.statics.findByTeamMember=function(e){return this.find({"team.userId":e,"team.isActive":!0})},n.pre("save",function(e){if(0===this.team.length&&this.team.push({userId:this.createdBy,role:"project_manager",permissions:["read","write","admin"],joinedAt:new Date,isActive:!0}),this.timeline.startDate&&this.timeline.endDate&&this.timeline.startDate>=this.timeline.endDate){e(Error("Start date must be before end date"));return}if(this.budget.actual&&this.budget.estimated&&(this.budget.actual<0||this.budget.estimated<0)){e(Error("Budget values cannot be negative"));return}e()}),n.pre("remove",function(e){e()});let s=a().models.Project||a().model("Project",n)}};var t=require("../../../webpack-runtime.js");t.C(e);var r=e=>t(t.s=e),i=t.X(0,[638,457,70,256],()=>r(33381));module.exports=i})();